(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["3652ccb9"],{"0ae9":function(t,e,n){},"1ab6":function(t,e,n){"use strict";var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(n("278c"));n("96cf");var a=i(n("c973"));n("551c");var r=i(n("d722")),o={user:null,getUser:function(){return this.user},fetchUser:function(t){return r.default.passport.verifyJWT(t).then(function(t){return r.default.service("users").get(t.userId)}).then(function(t){return Promise.resolve(t)})},authenticate:function(){var t=this;return console.log("auth",this.user),r.default.authenticate().then(function(e){return console.log("auth successful"),localStorage.setItem("tqks-auth",e.accessToken),t.fetchUser(e.accessToken)}).then(function(e){return console.log("got user"),t.user=e,Promise.resolve(e)}).catch(function(e){return console.log("auth failed",e),t.user=null,Promise.reject(e)})},authenticated:function(){return null!=this.user},signout:function(){var t=this;return console.log("signout"),r.default.logout().then(function(){console.log("XXX signout successful"),t.user=null}).catch(function(t){return console.log("signout failed",t),Promise.reject(t)})},onLogout:function(t){var e=this;r.default.on("logout",function(){console.log("onLogout"),e.user=null,t()})},onAuthenticated:function(t){var e=this;r.default.on("authenticated",function(n){console.log("onAuthenticate",n),e.fetchUser(n.accessToken).then(function(n){console.log("onAuthenticate got user"),e.user=n,t(e.user)}).catch(function(n){console.log("onAuthenticate get user failed",n),t(e.user)})})},register:function(t,e,n,i,s){return r.default.service("users").create({email:t,password:e,fullname:n,handle:i,homepage:s})},login:function(t,e){return r.default.authenticate({strategy:"local",email:t,password:e})},sendResetPassword:function(){var t=(0,a.default)(regeneratorRuntime.mark(function t(e){var n,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(console.info("Auth","sendResetPassword",{email:e}),e){t.next=3;break}throw new Error("Email invalid!");case 3:return n={action:"sendResetPwd",value:{email:e}},t.prev=4,t.next=7,r.default.service("authManagement").create(n);case 7:return i=t.sent,console.info("Auth","sendResetPassword","done",{result:i}),t.abrupt("return",i);case 12:throw t.prev=12,t.t0=t["catch"](4),t.t0;case 15:case"end":return t.stop()}},t,this,[[4,12]])}));return function(e){return t.apply(this,arguments)}}(),resetPassword:function(){var t=(0,a.default)(regeneratorRuntime.mark(function t(e,n){var i,a,o,u;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return i={action:"resetPwdLong",value:{token:e,password:n}},t.next=3,r.default.service("authManagement").create(i);case 3:if(a=t.sent,o=(0,s.default)(a,2),u=o[0],o[1],u){t.next=12;break}return notify.success("Your password was updated. You may now sign in under the new password."),t.abrupt("return",!0);case 12:notify.warning("Sorry but there was an error updating your password.");case 13:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},u=o;e.default=u},"5e36":function(t,e,n){"use strict";var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("386d");var s=i(n("3156")),a=i(n("1ab6")),r=i(n("ace7")),o=n("2f62"),u={name:"index",components:{},data:function(){return{leftDrawerOpen:this.$q.platform.is.desktop,rightDrawerOpen:this.$store.getters.isQuestView,isAuthenticated:!1,userId:null,isAdmin:!1,selected:null,search:""}},watch:{selected:function(t,e){this.$router.push({name:"questview",params:{id:t}})}},computed:(0,s.default)({authenticated:function(){var t=this.$store.getters.user,e=null!==t;return console.info("DA",e),console.info("DB",this.$store.getters.user),t&&(this.userId=t._id),e},user:function(){return this.$store.getters.user},isQuestView:function(){return this.$store.getters.isQuestView},simple:function(){var t=this.$store.getters.treeView;return t}},(0,o.mapGetters)("configuration",{currentConfig:"getCopy"}),{stillLoading:function(){return!(this.currentConfig&&this.currentConfig.cms)},cms:function(){return this.stillLoading?null:this.currentConfig.cms}}),methods:(0,s.default)({},(0,o.mapActions)("configuration",{fetchCurrentConfiguration:"get"}),{toggleNav:function(){this.rightDrawerOpen?this.closeNav():(this.rightDrawerOpen=!0,document.getElementById("mySidenav").style.width="450px")},closeNav:function(){this.rightDrawerOpen=!1,document.getElementById("mySidenav").style.width="0"},doSearch:function(){var t=this.search;this.$router.push({name:"search",params:{q:t}})},goTo:function(t){this.$router.push({name:t})},signout:function(){var t=this;a.default.signout().then(function(){t.$store.commit("usr",null),t.$store.commit("authenticate",!1),t.$store.commit("admin",!1),t.$q.notify({type:"positive",message:"You are now logged out, sign in again to continue to work"})}).catch(function(e){t.$q.notify({type:"positive",message:"Cannot logout, please check again in a few minutes"})})},setUser:function(t){this.$store.commit("usr",t)},checkAdmin:function(){var t=this.$store.getters.user;if(t){var e=t.email,n=r.default.adminEmail,i=this.$store.getters.isAuthenticated,s=e===n&&i;this.$store.commit("admin",s),this.isAdmin=s}}}),mounted:function(){var t=this;this.fetchCurrentConfiguration(1).then(function(t){console.log("Got config",t)}),console.info("MountingDefault",this.$store.getters.user),a.default.authenticate().then(function(e){t.setUser(e),t.$q.notify({type:"positive",message:"Restoring previous session"}),t.$store.commit("authenticate",!0),t.$store.commit("admin",!1),t.isAuthenticated=!0,t.checkAdmin()}).catch(function(e){t.setUser(null),t.$store.commit("authenticate",!1),t.$store.commit("admin",!1),t.$data.isAuthenticated=!1,t.$data.isAdmin=!1}),a.default.onAuthenticated(function(e){t.setUser(e),t.$store.commit("authenticate",!0),t.$data.isAuthenticated=!0,t.checkAdmin()}),a.default.onLogout(function(){t.setUser(null),t.$store.commit("authenticate",!1),t.$router.push({name:"home"}),t.$data.isAuthenticated=!1,t.$data.isAdmin=!1})},beforeDestroy:function(){}};e.default=u},"6e73":function(t,e,n){"use strict";n.r(e);var i=n("5e36"),s=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=s.a},"7b3d":function(t,e,n){"use strict";n.r(e);var i=n("aae7"),s=n("6e73");for(var a in s)"default"!==a&&function(t){n.d(e,t,function(){return s[t]})}(a);n("f70f");var r=n("2877"),o=Object(r["a"])(s["default"],i["a"],i["b"],!1,null,null,null);o.options.__file="default.vue",e["default"]=o.exports},aae7:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.cms?n("q-layout",[n("q-layout-header",[n("q-toolbar",{attrs:{color:"primary",glossy:!1,inverted:"ios"===t.$q.theme}},[n("q-btn",{attrs:{flat:"",dense:"",round:"","aria-label":"Menu"},on:{click:function(e){t.leftDrawerOpen=!t.leftDrawerOpen}}},[n("q-icon",{attrs:{name:"menu"}})],1),n("q-toolbar-title",[t._v("\n        "+t._s(t.cms.site.title)+"\n      ")]),n("q-search",{staticStyle:{"background-color":"white"},on:{keyup:function(e){return e.type.indexOf("key")||13===e.keyCode?t.doSearch(e):null}},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),t.authenticated?t._e():n("q-btn",{attrs:{flat:""},on:{click:function(e){return t.goTo("signin")}}},[t._v("Sign In")]),t.authenticated?t._e():n("q-btn",{attrs:{flat:""},on:{click:function(e){return t.goTo("register")}}},[t._v("Register")]),n("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.authenticated,expression:"authenticated"}],attrs:{flat:"",round:""},on:{click:function(e){return t.goTo("home")}}},[n("q-icon",{attrs:{name:"home"}}),n("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle",offset:[0,20]}},[t._v("Home")])],1),n("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.authenticated,expression:"authenticated"}],attrs:{flat:"",round:""},on:{click:function(e){return t.goTo("chat")}}},[n("q-icon",{attrs:{name:"chat"}}),n("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle",offset:[0,20]}},[t._v("Chat")])],1),n("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.authenticated,expression:"authenticated"}],attrs:{flat:"",round:""},on:{click:t.signout}},[n("q-icon",{attrs:{name:"exit_to_app"}}),n("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle",offset:[0,20]}},[t._v("Signout")])],1),t.isQuestView?n("q-btn",{attrs:{flat:"",dense:"",round:"","aria-label":"Tree View"},on:{click:t.toggleNav}},[n("q-icon",{attrs:{name:"menu"}})],1):t._e()],1)],1),n("div",{staticClass:"sidenav",attrs:{id:"mySidenav"}},[n("div",[t.simple?n("q-tree",{attrs:{nodes:t.simple,"node-key":"nodeId","default-expand-all":"",selected:t.selected},on:{"update:selected":function(e){t.selected=e}}}):t._e()],1)]),n("q-layout-drawer",{attrs:{side:"left","no-hide-on-route-change":"","content-class":"mat"===t.$q.theme?"bg-grey-2":null},model:{value:t.leftDrawerOpen,callback:function(e){t.leftDrawerOpen=e},expression:"leftDrawerOpen"}},[n("q-list",{attrs:{"no-border":"",link:"","inset-delimiter":""}},[n("q-item",{attrs:{to:"/home"}},[n("q-item-side",{attrs:{icon:"home"}}),n("q-item-main",{attrs:{label:"Home"}})],1),t.isAuthenticated?n("q-item",{attrs:{to:{name:"profile",params:{id:t.userId}}}},[n("q-item-side",{attrs:{icon:"settings"}}),n("q-item-main",{attrs:{label:"Profile"}})],1):t._e(),n("q-item",{attrs:{to:"/calendar"}},[n("q-item-main",{attrs:{label:"Calendar"}})],1),n("q-item",{attrs:{to:"/history"}},[n("q-item-side",{attrs:{icon:"history"}}),n("q-item-main",{attrs:{label:"History"}})],1),n("q-item",{attrs:{to:"/bookmarks"}},[n("q-item-side",{attrs:{icon:"bookmark"}}),n("q-item-main",{attrs:{label:"Bookmarks"}})],1),n("q-item",{attrs:{to:"/aboutb"}},[n("q-item-side",{attrs:{icon:"help"}}),n("q-item-main",{attrs:{label:"Bookmarks Help"}})],1),n("q-item",{attrs:{to:"/quests"}},[n("q-item-side",{attrs:{icon:"explore"}}),n("q-item-main",{attrs:{label:"Quests"}})],1),n("q-item",{attrs:{to:"/aboutc"}},[n("q-item-side",{attrs:{icon:"help"}}),n("q-item-main",{attrs:{label:"Quests Help"}})],1),n("q-item",{attrs:{to:"/topics"}},[n("q-item-side",{attrs:{icon:"info"}}),n("q-item-main",{attrs:{label:"Topics"}})],1),n("q-item",{attrs:{to:"/tags"}},[n("q-item-side",{attrs:{icon:"check_box"}}),n("q-item-main",{attrs:{label:"Tags"}})],1),n("q-item",{attrs:{to:"/aboutt"}},[n("q-item-side",{attrs:{icon:"help"}}),n("q-item-main",{attrs:{label:"Tags Help"}})],1),t.isAdmin?n("q-item",{attrs:{to:"/admin"}},[n("q-item-side",{attrs:{icon:"settings"}}),n("q-item-main",{attrs:{label:"Admin"}})],1):t._e(),t.isAuthenticated?n("q-item",{attrs:{to:"/chat"}},[n("q-item-side",{attrs:{icon:"chat"}}),n("q-item-main",{attrs:{label:"Chat"}})],1):t._e(),n("q-collapsible",{attrs:{icon:"info",label:"About"}},[n("p",{staticClass:"text-grey-7",staticStyle:{padding:"25px"}},[t._v("\n          This is a prototype\n          "),n("i",[t._v("Structured Conversation")]),t._v(" system.\n        ")])])],1)],1),n("q-page-container",[n("router-view",{attrs:{user:t.user}})],1),n("q-layout-footer",[n("a",{staticStyle:{float:"left"},attrs:{href:"http://www.topicquests.org/"}},[n("img",{attrs:{src:"assets/TopicQuestsLogo_sm.png"}})]),n("a",{staticStyle:{float:"right"},attrs:{href:"https://github.com/KnowledgeGarden/tqks-featherweight-prototype"}},[n("img",{attrs:{src:"assets/github-1.jpg"}})])])],1):t._e()},s=[];i._withStripped=!0,n.d(e,"a",function(){return i}),n.d(e,"b",function(){return s})},f70f:function(t,e,n){"use strict";var i=n("0ae9"),s=n.n(i);s.a}}]);